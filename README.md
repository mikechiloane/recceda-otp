# Recceda OTP

A simple, secure, and time-based One-Time Password (OTP) generation and verification library for Java.

# Recceda OTP

A simple, secure, and configurable One-Time Password (OTP) generation and verification library for Java.

## Features

*   **Secure OTP Generation**: Uses `java.security.SecureRandom` for cryptographically strong OTPs.
*   **Time-Based Validation**: OTPs are valid for a configurable amount of time.
*   **Secure Storage**: Stores OTPs using a secure SHA-256 hash, not in plain text.
*   **Configurable Generation Policies**: Enforce rules for OTP generation, such as preventing duplicate OTPs or limiting failed attempts.
*   **Flexible Distribution**: Callback mechanism allows for easy integration with any distribution method (SMS, email, etc.).
*   **Thread-Safe**: The OTP store is designed for concurrent use in multi-threaded environments.

## Installation

To use this library in your project, add the following dependency to your `pom.xml`:

```xml
<dependency>
  <groupId>com.recceda</groupId>
  <artifactId>recceda-otp</artifactId>
  <version>1.0.0</version>
</dependency>
```

## Usage

Here is a simple example of how to generate and verify an OTP for a user.

```java
import com.recceda.ReccedaOtp;
import com.recceda.core.store.OtpStore;
import com.recceda.core.store.ReccedaOtpStore;
import com.recceda.core.policy.GenerationPolicy;
import com.recceda.core.policy.PreventDuplicateOtpPolicy;
import com.recceda.core.reason.OtpReason;
import java.util.List;
import java.util.Arrays;

public class Example {

    public static void main(String[] args) {
        // 1. Create an instance of the OTP store.
        OtpStore otpStore = new ReccedaOtpStore();

        // 2. Define the generation policies you want to enforce.
        List<GenerationPolicy> policies = Arrays.asList(new PreventDuplicateOtpPolicy());

        // 3. Create the main ReccedaOtp object, injecting the store and policies.
        ReccedaOtp reccedaOtp = new ReccedaOtp(otpStore, policies);

        String userId = "test-user-123";

        // 4. Generate a new OTP for a user for a specific reason.
        reccedaOtp.generateOtp(userId, OtpReason.LOGIN, (key, otp) -> {
            System.out.println("Generated OTP for " + key + " for reason " + OtpReason.LOGIN + ": " + otp);
            // In a real application, you would send the OTP via email or SMS here.
        });

        // 5. Verify the OTP for the same reason.
        boolean isCorrect = reccedaOtp.verifyOtp(userId, "123456", OtpReason.LOGIN);
        System.out.println("Verification for LOGIN successful: " + isCorrect);
    }
}
```

## OTP Reasons

When generating an OTP, you must provide a reason. This helps in auditing and applying different policies based on the context. A user can have multiple active OTPs as long as they are for different reasons. The available reasons are:

*   `OtpReason.LOGIN`
*   `OtpReason.SIGNUP`
*   `OtpReason.RESET_PASSWORD`

## Generation Policies

You can control the conditions under which an OTP should be generated by providing a list of policies. Policies are checked for a specific user and reason. If any policy check fails, an `OtpGenerationException` will be thrown.

### Included Policies

*   **`PreventDuplicateOtpPolicy`**: Prevents the generation of a new OTP if the user already has an active (non-expired) one for the same reason.
*   **`MaxFailedAttemptsPolicy(int maxAttempts)`**: Prevents OTP generation if the user has failed verification more than `maxAttempts` times for the same reason.

### Example with Multiple Policies

```java
List<GenerationPolicy> policies = Arrays.asList(
    new PreventDuplicateOtpPolicy(),
    new MaxFailedAttemptsPolicy(10)
);

ReccedaOtp reccedaOtp = new ReccedaOtp(new ReccedaOtpStore(), policies);
```

## Building from Source

To build the project from source, you will need:
*   Java 8 or higher
*   Apache Maven

Clone the repository and run the following command from the project root:

```bash
mvn clean install
```

This will compile the source code, run the tests, and install the package into your local Maven repository.

## Contact

For any questions or inquiries, please contact Mike at [mike@mikechiloane.co.za](mailto:mike@mikechiloane.co.za).
